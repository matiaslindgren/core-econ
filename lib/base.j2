<!DOCTYPE HTML>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{{ metadata.desc }}">
    <title>{{ metadata.title }}</title>

    {% set deps = [
      'vega@5',
      'vega-lite@4',
      'vega-embed@6',
    ]
    %}
    {% for dep in deps %}
      <script src="https://cdn.jsdelivr.net/npm/{{ dep }}" crossorigin="anonymous">
      </script>
    {% endfor %}

    <style>
    {% include "style.css" %}
    </style>

    {% block head %}
    {% endblock %}

  </head>

  <body>
    {% if module_name != 'index' %}
      <a href="index.html">go back</a>
    {% endif %}
    <h1>{{ metadata.title }}</h1>
    <dl>
      <dt>Created at</dt>
      <dd>{{ created_at }}</dd>
      {% if metadata.desc %}
        <dt>Description</dt>
        <dd>{{ metadata.desc }}</dd>
      {% endif %}
      {% if metadata.src %}
        <dt>Data source</dt>
        <dd>{{ metadata.src }}</dd>
        <dt>Data downloaded from</dt>
        <dd><a href="{{ metadata.url }}">{{ metadata.url_name }}</a></dd>
      {% endif %}
      {% if metadata.chapter %}
        <dt>Book chapter</dt>
        <dd><a href="{{ metadata.chapter_url }}">{{ metadata.chapter }}</a></dd>
      {% endif %}
    </dl>

    {% if has_chart %}
      <div id="vega-container"></div>
      <script type="text/javascript">
        const spec = {{ vega_spec }};
        const options = {{ vega_opt }};
        vegaEmbed("#vega-container", spec, options).then(() => {
          const bindings = document.querySelector("#vega-container.vega-embed form.vega-bindings");
          const canvas = document.querySelector("#vega-container.vega-embed canvas");
          canvas.parentNode.insertBefore(bindings, canvas);
        });
      </script>
    {% endif %}

    {% block body %}
    {% endblock %}

  </body>

</html>
